<!DOCTYPE html>
<html lang="en" qva-bootstrap="false">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">	
		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>	

		<link rel="stylesheet" href="https://usrem-csq.qliktech.com/ticket_proxy/resources/autogenerated/qlik-styles.css">	
		<script type="text/javascript" src = 'https://usrem-csq.qliktech.com/ticket_proxy/resources/assets/external/requirejs/require.js'></script>  
	</head>
	<body ngCloak>	
		<script>			

				$.ajax({
				  url: "/authenticate",
				  type: "get", //send it through get method
				  data: { 
				    
				  },
				  success: function(response) {			    			    			    

					  if (typeof(require) == 'undefined') { 
						// look for require. If it's not loaded, fetch app_login from the content library. Make sure this file has been uploaded to the default content library. 
		   				
		   				// make sure to change the url with the url of your qlik engine and the virtual proxy for ticketing yuo use
		   				// usrem-csq.qliktech.com/ticket_proxy is for my machine
						window.location.replace('https://usrem-csq.qliktech.com/ticket_proxy/content/Default/app_login.html?qlikTicket=' + response.Ticket); 

						} else {												
							
							window.config = {
								host: "usrem-csq.qliktech.com",
								prefix: "/ticket_proxy/",
								port: 443,
								isSecure: true
							};

							let senseApp; 

							//	 ____  _____ ___  _   _ ___ ____  _____
							//	|  _ \| ____/ _ \| | | |_ _|  _ \| ____|
							//	| |_) |  _|| | | | | | || || |_) |  _|
							//	|  _ <| |__| |_| | |_| || ||  _ <| |___
							//	|_| \_\_____\__\_\\___/|___|_| \_\_____|

							let baseUrl = ( config.isSecure ? "https://" : "http://" ) + config.host + (config.port ? ":" + config.port: "") + config.prefix + "resources"; 

							require.config( {
								baseUrl: baseUrl, 
								waitSeconds: 1000,
								paths: {
									'public': 'https://localhost:3000/public'      
								}
							} );

							require( ["js/qlik", 'public/sample_controller'], function ( qlik) {							
								console.log('qlik loaded!', qlik); 			
								angular.bootstrap(document, ["senseApp", "qlik-angular"]);

								
							});


							angular.module('senseApp', [])
							.run(function($rootScope){
								console.log('running rootScope!'); 
							})



						}			    
				  },
				  error: function(err) {
				    console.log('error on authenticate request!', err); 	
				  }
				});

			
		
		</script>
		
		<div ng-controller='SampleController'>
			<div id='CurrentSelections'></div>
			<br>		
			<h1>Sample Qlik Mashup</h1>		
			<h2>{{messages.hello}}</h2>				
			<br>				
		</div>
		<br>
		<div class='flex_container' style='height: 400px'>
			<div class='qvobject' id='qlik_object' style='height: 100%'></div>		
		</div>
		
	</body>
</html>


